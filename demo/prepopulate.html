<!doctype html>
<html>
<head>
  <meta charset='utf-8'>
  <title>Pre-populate new rows from template - Handsontable</title>

  <!--
  Loading handsontable dependencies.
  Please note that some dependencies are optional:
   - bootstrap-typeahead.js - is required only if you need the sexy autoexpanding textarea feature
   - jquery.autoresize.js   - is required only if you need the autocomplete feature
   - jquery.contextMenu.js  - is required only if you need the context menu feature
   - jquery.contextMenu.css - is required only if you need the context menu feature
   - jquery.ui.position.js  - is required only if you need the context menu feature
  -->
  <script src="../lib/jquery.min.js"></script>
  <script src="../jquery.handsontable.js"></script>
  <script src="../lib/bootstrap-typeahead.js"></script>
  <script src="../lib/jquery.autoresize.js"></script>
  <script src="../lib/jQuery-contextMenu/jquery.contextMenu.js"></script>
  <script src="../lib/jQuery-contextMenu/jquery.ui.position.js"></script>
  <link rel="stylesheet" media="screen" href="../lib/jQuery-contextMenu/jquery.contextMenu.css">
  <link rel="stylesheet" media="screen" href="../jquery.handsontable.css">

  <!--
  Loading demo dependencies. They are used here only to enhance the examples on this page
  -->
  <script src="js/json2.min.js"></script>
  <link rel="stylesheet" media="screen" href="css/demo.css">

  <!--
  Google Analytics for GitHub Page. Don't copy this to your project :)
  -->
  <script type="text/javascript">
    if (window.location.hostname === 'handsontable.com' || window.location.hostname === 'www.handsontable.com' || window.location.hostname === 'warpech.github.com') {
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-33932793-1']);
      _gaq.push(['_setDomainName', window.location.hostname]);
      _gaq.push(['_trackPageview']);

      (function () {
        var ga = document.createElement('script');
        ga.type = 'text/javascript';
        ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(ga, s);
      })();
    }
  </script>

  <meta property="og:title" content="Pre-populate new rows from template - Handsontable">
  <meta property="og:description" content="Below example shows how Legend match function can be used to present the template values for empty rows">
  <meta property="og:url" content="http://handsontable.com/demo/prepopulate.html">
  <meta property="og:image" content="http://handsontable.com/demo/image/og-image.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:image:width" content="409">
  <meta property="og:image:height" content="164">
  <link rel="canonical" href="http://handsontable.com/demo/prepopulate.html">
</head>

<body>
<a href="http://github.com/warpech/jquery-handsontable"><img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"/></a>

<div id="container">
  <h1><a href="../index.html">Handsontable</a></h1>

  <div class="description">
    Handsontable is a minimalistic approach to Excel-like table editor in HTML & jQuery
    <br><a href="../index.html">&lt; back to main</a>
  </div>

  <h2>Pre-populate new rows from template</h2>

  <p>Below example shows how <b>Legend</b> match function can be used to present the template values for empty rows.</p>

  <p>When any cell in the empty row is edited, the
    <b>onChange</b> callback fills the row with the template values.</p>

  <div id="exampleGrid" class="dataTable"></div>

  <p>Callback console: <span class="code">[[row, col, oldValue, newValue], ...]</span></p>

  <pre id="exampleConsole" class="console">Edit the above grid to see callback</pre>

  <style>
    .placeholder {
      color: #777;
      font-style: italic;
    }
  </style>
  <script>
    function countEmpty(arr) {
      var empty = 0;
      for (var i = 0, ilen = arr.length; i < ilen; i++) {
        if (arr[i] === '') {
          empty++;
        }
      }
      return empty;
    }

    var tpl = ["one", "two", "three"];

    var container = $("#exampleGrid");
    container.handsontable({
      startRows: 8,
      startCols: 5,
      minSpareRows: 1,
      contextMenu: true,
      legend: [
        {
          match: function (row, col, dataFn) {
            if (row === 0) {
              return;
            }

            var data = dataFn();
            var empty = countEmpty(data[row]);
            var c, clen, td;
            if (empty === data[row].length) {
              //whole row is empty
              for (c = 0, clen = tpl.length; c < clen; c++) {
                td = container.handsontable('getCell', row, c);
                td.innerHTML = tpl[c];
                td.className = "placeholder";
              }
            }
            else {
              td = container.handsontable('getCell', row, 0);
              if (td.className === 'placeholder') {
                for (c = 0, clen = tpl.length; c < clen; c++) {
                  td = container.handsontable('getCell', row, c);
                  td.className = "";
                }
              }
            }
          }
        }
      ],
      onChange: function (changes) {
        for (var i = 0, ilen = changes.length; i < ilen; i++) {
          if (changes[i][2] === '') { //if oldVal is empty
            var data = container.handsontable('getData');
            var row = changes[i][0];
            if (countEmpty(data[row]) === data[row].length - 1) {
              //other cells in this row are empty
              for (var c = 0, clen = tpl.length; c < clen; c++) {
                if (changes[i][1] !== c) {
                  container.handsontable('setDataAtCell', row, c, tpl[c]);
                }
              }
            }
          }
        }

        $("#exampleConsole").text(JSON.stringify(changes));
      }
    });

    var data = [
      ["", "Kia", "Nissan", "Toyota", "Honda"],
      ["2008", 10, 11, 12, 13],
      ["2009", 20, 11, 14, 13],
      ["2010", 30, 15, 12, 13]
    ];

    container.handsontable("loadData", data);
  </script>

  <h3>About</h3>

  <p>This is advanced usage example of <a href="../index.html">Handsontable</a>. Check out the
    <a href="../index.html">main page</a> for more demos.</p>
</div>
</body>
</html>